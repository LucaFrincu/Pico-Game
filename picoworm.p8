pico-8 cartridge // http://www.pico-8.com
version 41
__lua__
--player start position
x, y = 145, 20

--acceleration
ax, ay = 0, 0

--velocity
vx, vy = 0, 0

hist_x = {}
hist_y = {}

npc_exists = true
npc_timer = 0 
game_state = "menu"
npc_eaten_count = 0 

function _init()
    -- 15 seconds life
    countdown = 15
    spawn_npc()
end

function _draw()
    cls()
    
    if game_state == "menu" then
        draw_menu()
    elseif game_state == "game" then
        draw_game()
    elseif game_state == "end" then
        draw_end()
    end
end

function _update()
    if game_state == "menu" then
        update_menu()
    elseif game_state == "game" then
        update_game()
    elseif game_state == "end" then
        update_end()
    end
end

function draw_game()
    camera_follow()

    map()

    -- tail
    for i=1, #hist_x do
        spr(81, hist_x[i], hist_y[i])
    end

    -- head 
    spr(82, x, y)

    -- bug npc
    if npc_exists then
        spr(74, npc_x, npc_y)
    end

    -- countdown timer coordinates
    camera(0, 0)  
    print("time: "..flr(countdown), 0, 0, 1)
end

function update_game()
    ay = 0
    if (btn(⬆️)) ay=-5 
    if (btn(⬇️)) ay=5
    if (btn(⬅️)) ax=-3
    if (btn(➡️)) ax=3

    if ax > 0 then ax = ax-0.1 end
    if ax < 0 then ax = ax+0.1 end
    ay = ay + 0.3 -- gravity

    vx = vx + ax * 0.1
    vy = vy + ay * 0.1

    add(hist_x, x)
    add(hist_y, y)
    if (#hist_x > 10) then
        deli(hist_x, 1)
        deli(hist_y, 1)
    end

    -- update position
    x = x + vx
    y = y + vy

    -- check bottom boundary
    if y > 26 * 8 then 
        y = 26 * 8
        vy = 0 
    end
    
    -- check top boundary
    if y < 2 * 8 then
        y = 2 * 8
        vy = 0
    end
    
    -- check left boundary
    if x < 2 * 8 then
        x = 2 * 8
        vx = 0
    end
    
    -- check right boundary
    if x > 43 * 8 then
        x = 43 * 8
        vx = 0
    end

    -- check collision with npc
    if npc_exists and abs(x - npc_x) < 8 and abs(y - npc_y) < 8 then
        npc_exists = false
        countdown = countdown + 3
        npc_eaten_count = npc_eaten_count + 1 -- increment the counter
        spawn_npc()
    end

    -- update countdown timer
    countdown = countdown - (1 / 30) -- assuming _update() is called 30 times per second
    if countdown < 0 then
        countdown = 0 
        game_state = "end" 
    end
end

function spawn_npc()
    npc_x = flr(rnd(43 * 8))
    npc_y = flr(rnd(24 * 8)) + 2 * 8
    npc_exists = true
end

function camera_follow()
    
end

-->8
-- camera follow script
function camera_follow()

 cam_x=x-60
 cam_y=y-60

 cam_x=mid(0,cam_x,896)
 cam_y=mid(0,cam_y,128)
 
 camera(cam_x,cam_y)
 
end
-->8
function draw_menu()
    -- draw the background
    rectfill(0, 0, 127, 127, 1) -- draw a rectangle from (0, 0) to (127, 127) with color 1 (dark blue)
    
    -- draw the main menu text
    print("main menu", 44, 30, 3)
    print("press ❎ to start", 36, 50, 8)
end

function update_menu()
    if btnp(❎) then
        game_state = "game"
    end
end

function draw_end()
    -- draw the background
    rectfill(0, 0, 127, 127, 1) 
    
    -- end screen text
    print("you died of hunger", 34, 30, 8)
    print("you ate "..npc_eaten_count.." bugs", 34, 40, 2)
    print("press ❎ to restart", 32, 50, 7)
end

function update_end()
    if btnp(❎) then 
        restart_game()
    end
end

function restart_game()
    -- reset variables to default
    x, y = 64, 64
    ax, ay = 0, 0
    vx, vy = 0, 0

    hist_x = {}
    hist_y = {}

    npc_x, npc_y = 32, 32
    npc_exists = true
    npc_timer = 0

    npc_eaten_count = 0 
    countdown = 15 
    game_state = "game" 

    spawn_npc()
end

__gfx__
0000000000000000000000004444444444444444555555555555555500000000000000000000000000000000343633433333333344444444cccccccccccccccc
000000000000000000000000444444363634444455555555555555550000000000000000000000000000000063943694f3f33f3344444444cccccccccccccccc
000000000000000000000000444443333333444455555555555555550000000000000000000000000000000044344334ff3fff4f44444444cccccccccccccccc
00000000000000000000000044444433a334444455555555555555550000000000000000000000000000000043439444ff4fffff44444444cccccacccccccccc
00000000000000000000000044444442aa444444555555666766655500000000000000000000000000000000444444444ffff4ff44444444cccca7acccaccccc
0000000000000000000000004444333aaa33344455556665566666650000000000000000000000000000000044444444fff4fff444444444ccccc3ccca8acccc
000000000000000000000000444b344a2a443b4466656f76566655750000000000000000000000000000000044444444ffffffff44444444ccc8c3c8ccbcc2cc
0000000000000000000000004444444aaa4444446665576f666655650000000000000000000000000000000044444444ff4ffff444444444cccbc3cbccbccbcc
44444444444444440000000044444442aa44444456665676655665656555655600000000000000004444444445c444444504444466666655cccccccc45a44444
4444444444444444000000004444333aaa333444565556557655666555557565000000000000000046674464444447c44444450456655667cccccccc444445a4
446666444444444400000000444b344a2a443b44555555555765555557655556000000000000000046674464444445444444454456555667cccccccc44444544
44666664444444440000000044444443a3444444556555555566555555556555000000000000000044664444444744444444444456666757cccccccc44444444
4466666666664444000000004444444b3b444444555555555557655556555555000000000000000044444664445cc4444450044456655555cccccccc445aa444
44466666666666440000000044444444b4444444655555555555555555566556000000000000000044446664444544444445444456665757cccccccc44454444
4446666777766664000000004444444444444444555555555555555566555555000000000000000046646774454444c74544444455666666cccccccc45444444
44466666677666640000000044444444444444445555555555555555555756550000000000000000446444444c7444454444444555555555cccccccc4a444445
44446666666666660000000044444444444444445555555555555555aaaaaaaaaaaaaaaa555555555555555545a4444444444444444444444444444444444444
44444666666666660000000044444444444444445555555555555555aaaaa7aaaaaaa77a5555555555555555444445a444444444444444444444444444444444
44444466666666660000000044444444444444445555555555555555aaaa7aaaaa7a7aaa55555555555555554444454444444446666444444444444444444444
444444466666666600000000444444444444444457555555555555557a77aaaaaa7aaaaa55555555555555554444444446664444467644444444444444444444
44444444444446660000000044444444444444445655555555555555aaaaaaaaaaaaaaaa5545555554555555445aa44446774444477444444444444544444444
444444444444444400000000444444dddddd88885666555556655555aaaaaaaaaaaaa7aa55554545455555444445444447664444444444444544544445544454
444444444444444400000000444ddd22222228a755667666f6577655aaaaa77aaaaaaaaa45454455545454554544444446744444444444444554455445555445
4444444444444444000000004ddd22222ddd28885556666755565676aaaaaaaaaaaaaaaa44444444444444444a44444544444444444444445555555555555444
0000000000000000000000004d2222dddd4dd88855555667556556f5aaaaaaaaaaaaaaa746444444444444445565555544444444444446645555555555455554
0000000000000000000000004ddddd44444444445555555665755f55aaaaaaaaaaaaaaaa44446464664466445555555544444444444466745555555555555555
0000000000000000000000004444444444444444555555556f655655aaaaaaaaaaaaaaaa69449999994949995555555544444444444447645455555545555455
00000000000000000000000044444444444444445555555556676f66aaaaaaaaaaaaaaaaa9999969999999a95555555544444444444446445555555555555555
00000000000000000000000044444444444444445555555555f5556faaaaaaaaaaaaaaaa9a9999a9999999995555565544444666644444445555554555545455
000000000000000000000000444444444444444455555555566555f5aaaaaaaaaaaaaaaa99a99a9999a9aa995555555544446676744444445555555554555555
000000000000000000000000444444444444444455555556f5555665aaaaaaaaaaaaaaaaaaaaaa77aa9aaaa96555555544444667444444445555555555555555
00000000000000000000000044444444444444445555555555555655aaaaaaaaaaaaaaaaa77aa7a7aa7a77aa5555555544444444444444445555555555555555
00000000000000000000000000000000000000000000000000000000000000000000000000000000666666660000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000061e55e160000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000688558860000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000588558850000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000555555550000000000000000000000000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000000005ee11ee50000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000051e11e150000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000055e55e550000000000000000000000000000000000000000
00000000003333000775577000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000344443073b55b3700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000366666637b5555b700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000063bb33b65555555500000006660000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000006b33bb365515515500000762226700000000000666000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000366666632255552200000622222600000000006777600000000000000000000000000000000000000000000000000000000000000000000000000000
0000000003444430202552020000057b5b7500000000067292760000000000000000000000000000000000000000000000000000000000000000000000000000
000000000033330000200200000005b555b500000000067929760000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000555555500000000067292760000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000225552200000000006777600000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000205050200000000000666000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90809080808080808080808080809080908090809080908090809080908090809080908090809080908080809080908090809081819100000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
91819181918191818081808091819181918191819181918191819181918191819181918191819181917181819181918191819181809000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
90809080908090809080908090809080908090809080908090809080908090809080908090809080908090809080908090809080809000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
91819181918191819181918191819181918191819181918191819181918191819181918191819181918191819181918191819181819100000000000000000000
__map__
0e1e1e1e1e0f1e0e1e1e1e1e1e1e0f0e1e1e0e1e0f1e1e1e0f1e1e0e1e0f0e1e1e0f1e1e0e0f1e1e0e1e0f1e1e1e0f1e1e1e0e1e00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c0c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3f3e0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b0b3f3e3f3e3e3e3f3f00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b0d0d0d0d0d0d0d0d0d0d0d0d0d0d10110d0d0d0d0d0d0d0d0d1c0d0d0d1c0d0d1a0d0d0d0d1c0d0d0d0d3b173e173b17173b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b170d0d0d0d1c0d1a0d0d1c0d0d0d0d20210d0d0d0d0d1c0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d17171717173b171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17170d0d0d0d0d0d0d0d0d0d0d0d1c1c0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d1c0d0d0d0d0d0d0d0d0d173b1717173e171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b1c0d0d0d0d3c0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d10110d0d0d1c0d0d0d0d0d0d0d0d0d0d0d0d0d1717173b1717173b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b170d0d0d0d0d2c0d1c0d0d0d0d0d0d0d0d0d0d1c0d0d0d0d20210d0d0d0d0d0d0d1c0d0d0d0d0d0d1a0d0d173b1717173b171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17170d0d0d0d0d0d0d0d0d0d0d1c0d0d0d0d0d0d1a0d0d0d0d0d0d0d0d2c2d0d0d0d0d0d0d0d0d0d0d0d0d0d171717171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b0d0d0d2c2d0d0d0d0d0d0d0d0d0d0d1c0d0d0d0d0d0d1c1c0d0d0d3c3d0d0d0d0d0d0d1a0d0d0d0d0d0d171717173b17173b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17170d1c0d3c3d0d0d0d0d1a0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d172526171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b0d0d0d0d0d1c0d0d0d0d1c0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d1c0d0d0d0d0d0d0d0d0d0d0d1735361d1717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b170d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d1c0d0d0d0d0d0d0d1a0d0d0d0d0d0d0d1c0d0d0d0d0d0d17173b17173b171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17170d0d0d0d0d0d0d0d0d0d0d2c2d0d0d1a0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d2c2d0d1717173b171717173b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17170d0d0d0d0d0d0d0d0d0d0d3c3d0d0d0d0d0d0d0d0d0d0d3d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d3c3d0d173b173b173b171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2f2e2e171717173b173b1700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b173e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3e3f3f3f173b173b17173b1700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17173b3b3b3b3b3b25263b3b3b3b3b3b3b3b3b3b05063b3b25263b3b3b3b3b3b3b3b3b3b3b3b3b3b1d3b3b3b17173b171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b1725263b3e3f3f35361d3f3e3b3e3b3e3f3f3e15163e3f35361d3f3e3e3e3e3b3e3e3e3f3e3b3f3e3e3e3b171717171705061700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
171735363f3f3f3b3f3f3f3e3f3f3b3b3b3f3f3e3f3f3f3e3b3f3e3b3f3f25263f3f3f3e3e3f3e3f3f3e3f3f173b173b1715161700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3b3e3b3e3b35363b3b1d3b3b3b3b3b3b3b3b3b171717171717173b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17172a292929292a292a29292a292a292a2929292a2a292a292a2a292929292a292a2a29292a292a29292a29173b173b173b3b1700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b0d0d1f0d0d0d1f0d0d0d0d0d1f0d0d0d1c0d0d1f0d0d0d0d0d0d0d0d0d0d0d0d0d0d1b0d0d1f0d0d0d0d173b17173b17171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17170d0d0d0d0d0d1b0d0d1c0d0d0d1c0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d1f0d0d0d0d0d0d0d1b0d0d1717173b17173b1700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b170d0d0d1f0d0d0d0d0d0d0d1f0d0d1f0d0d0d0d1f0d0d0d0d0d0d1b0d0d0d0d0d0d0d0d0d0d0d0d0d0d0d173b1717173b173b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3b170d0d0d0d0d0d0d1c0d0d0d0d0d0d1c0d0d1b0d0d0d1c0d1b0d0d0d0d0d0d1b0d0d0d0d0d0d0d0d0d1f0d17173b171717171700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
173b292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a292a2a292a2900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
393a393a3939393a393a393a393a393a393a393a393a393a393a393a393a393a393a393a393a393a393a393a3939393a393a393a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2728272828382727282728272827282827282728272728272827282728282728272827282728272827282728282728282828282800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3738373838383837383738373837383837383738373738373837383738383738373837383738373837383738383837373737373700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0908090809080707070707070707070707070707070707070707070707070707070707070707070707080908090809080908090809070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
1918191819080708080808080807070707070707070707070707070707070707070707070707070707181918191819181918190808090000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
